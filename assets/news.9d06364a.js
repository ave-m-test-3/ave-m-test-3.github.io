import{s as service,_ as _export_sfc}from"./index.67f94cb9.js";import{X as ImagePreview,r as resolveComponent,o as openBlock,x as createElementBlock,c as createBlock,H as createCommentVNode,C as createBaseVNode,E as toDisplayString,D as normalizeStyle,y as createVNode,w as withCtx,M as pushScopeId,O as popScopeId,F as Fragment,z as renderList,I as createTextVNode,J as withModifiers}from"./vendor.a48c6377.js";function getNewsList(e){return service({method:"get",url:"/v1api/v2/discover/news",params:{lang:e.lang,userAddress:e.userAddress,pageNO:e.pageNo,pageSize:e.pageSize}})}function newsVote(e){return service({method:"post",url:"/v1api/v2/discover/newsVote",params:{userAddress:e.userAddress,newsId:e.newsId,vote:e.vote}})}function getNewsAd(){return service({method:"get",url:"/v1api/v2/discover/newsAd"})}var _imports_0="/assets/ave-empty.a9f4da8d.png",news_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main={name:"GlobalCommunity",components:{},data(){return{active:-1,list:[],loading:!1,images:[],showAd:eval(localStorage.getItem("showAd")||!0),showNotice:eval(localStorage.getItem("showNotice")||!0),conditions:{pageNo:1,pageSize:2,lang:"",userAddress:""},total:"",day:"",finished:!1,refreshing:!1,top:0,bottom:0}},mounted(){var e;this.$store.commit("switchTypeUpDown",(null==(e=this.$route.query)?void 0:e.typeUpDown)||0),this.getNewsList(this.conditions),this.getNewsAd(),this.$nextTick((()=>{var e,t,o,s,i,a;this.top=(null==(o=null==(t=null==(e=this.$refs)?void 0:e.top)?void 0:t.$el)?void 0:o.offsetHeight)||0,this.bottom=(null==(a=null==(i=null==(s=this.$refs)?void 0:s.bottom)?void 0:i.$el)?void 0:a.offsetHeight)||0}))},computed:{language(){return this.$store.getters.language}},watch:{"$store.state.currentAccount"(e){this.refreshing=!1,this.loading=!1,this.list=[],this.conditions.pageNo=1,this.getNewsList(this.conditions)},showNotice(e){e||(this.top=0)},showAd(e){e||(this.bottom=0)}},methods:{closeNotice(){this.showNotice=!1,localStorage.showNotice=!1},closeAd(){this.showAd=!1,localStorage.showAd=!1},getNewsList(e){return new Promise(((t,o)=>{this.loading=!0,this.conditions.userAddress=this.$store.state.currentAccount,this.conditions.lang="zh-cn"===this.language||"zh-tw"===this.language?"zh":"en",getNewsList(e).then((e=>{var o,s,i,a;let n=null==(o=null==e?void 0:e.data)?void 0:o.list;this.day=(null==(s=this.list[0])?void 0:s.created_at)?this.$f.formatDate((null==(i=this.list[0])?void 0:i.created_at)||"","YYYY-MM-DD"):"",this.total=null==(a=null==e?void 0:e.data)?void 0:a.total,1==this.refreshing&&(this.list=n),t(n)})).catch((e=>{console.log(e),o([])})).finally((()=>{this.loading=!1}))}))},async refresh(){this.refreshing=!0,this.conditions.pageNo=1,await this.getNewsList(this.conditions),this.refreshing=!1},async onLoad(){this.conditions.pageNo++;let e=await this.getNewsList(this.conditions);this.list.push(...e),this.list.length>=this.total&&(this.finished=!0)},dealDate(e){var t=Date.parse(new Date),o=e,s=parseInt(t)/1e3-parseInt(o);if((s=Math.abs(s))<10)return this.$t("justNow");if(s<60&&s>=10)return Math.floor(s)+this.$t("ss");var i=s/60;if(i<60)return Math.floor(i)+this.$t("min");var a=s/3600;return a<24?Math.floor(a)+this.$t("hour"):a>=24?this.$f.formatDate(e):void 0},view(e){this.$f.openBrowserAll(e.url)},getNewsAd(){getNewsAd().then((e=>{this.images=(null==e?void 0:e.data)||[]})).finally((()=>{}))},newsVote(e,t,o){let s=this.$store.state.currentAccount;if(!s||"undefined"===s)return void this.$toast({message:this.$t("connectWalletFirst"),position:"top"});if(1==e.myVote&&1==t)return void this.$toast({message:this.$t("voted"),position:"top"});if(-1==e.myVote&&-1==t)return void this.$toast({message:this.$t("voted"),position:"top"});newsVote({userAddress:s,newsId:e.id,vote:t}).then((()=>{this.$toast({message:this.$t("success")}),this.list[o].myVote=t,1==t?(this.list[o].badCount=this.list[o].badCount>0?this.list[o].badCount-1:0,this.list[o].goodCount=this.list[o].goodCount+1):(this.list[o].badCount=this.list[o].badCount+1,this.list[o].goodCount=this.list[o].goodCount>0?this.list[o].goodCount-1:0)})).catch((e=>{this.$toast({message:e})}))},ImagePreview:ImagePreview}},_withScopeId=e=>(pushScopeId("data-v-38cae3d9"),e=e(),popScopeId(),e),_hoisted_1={class:"news-container"},_hoisted_2={class:"content"},_hoisted_3={key:0,class:"title padding"},_hoisted_4=_withScopeId((()=>createBaseVNode("i",{class:"iconfont icon-calendar blue"},null,-1))),_hoisted_5={class:"font-500"},_hoisted_6=_withScopeId((()=>createBaseVNode("span",{class:"circle"},null,-1))),_hoisted_7={class:"item"},_hoisted_8={class:"flex-between"},_hoisted_9={class:"color-999"},_hoisted_10={class:"color-999"},_hoisted_11={key:0,class:"flex-start mt-10"},_hoisted_12=_withScopeId((()=>createBaseVNode("img",{src:_imports_0,style:{width:"30px",height:"30px"},alt:"",srcset:""},null,-1))),_hoisted_13={class:"ml-5"},_hoisted_14={class:"block title"},_hoisted_15=_withScopeId((()=>createBaseVNode("i",{class:"iconfont icon-v"},null,-1))),_hoisted_16={key:0,class:"color-999 font-10"},_hoisted_17=_withScopeId((()=>createBaseVNode("i",{class:"iconfont icon-forward font-10"},null,-1))),_hoisted_18={key:1,class:"title mt-10 block"},_hoisted_19={class:"color-666 mt-10"},_hoisted_20=["innerHTML"],_hoisted_21={class:"flex-end mt-10"},_hoisted_22=["onClick"],_hoisted_23={key:1,class:"ad",ref:"bottom"},_hoisted_24={class:"bg absolute-left"},_hoisted_25=["src","alt"];function _sfc_render(e,t,o,s,i,a){const n=resolveComponent("van-notice-bar"),l=resolveComponent("van-image"),r=resolveComponent("van-col"),d=resolveComponent("van-row"),c=resolveComponent("van-step"),h=resolveComponent("van-steps"),_=resolveComponent("van-list"),u=resolveComponent("van-pull-refresh"),p=resolveComponent("van-icon"),g=resolveComponent("van-swipe-item"),v=resolveComponent("van-swipe");return openBlock(),createElementBlock("section",_hoisted_1,[i.showNotice?(openBlock(),createBlock(n,{key:0,ref:"top",wrapable:"",mode:"closeable",text:e.$t("newsTip"),onClose:a.closeNotice},null,8,["text","onClose"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2,[i.day?(openBlock(),createElementBlock("div",_hoisted_3,[_hoisted_4,createBaseVNode("span",_hoisted_5,toDisplayString(i.day),1)])):createCommentVNode("",!0),createBaseVNode("div",{class:"container",ref:"middle",style:normalizeStyle({height:`calc(100vh - ${i.top}px - ${i.bottom}px)`})},[createVNode(u,{modelValue:i.refreshing,"onUpdate:modelValue":t[1]||(t[1]=e=>i.refreshing=e),onRefresh:a.refresh,"loosing-text":e.$t("loosingText"),"pulling-text":e.$t("pullingText"),"loading-text":e.$t("loading")},{default:withCtx((()=>[createVNode(_,{loading:i.loading,"onUpdate:loading":t[0]||(t[0]=e=>i.loading=e),finished:i.finished,"loading-text":e.$t("loading"),"finished-text":e.$t("noMore"),onLoad:a.onLoad},{default:withCtx((()=>[createVNode(h,{direction:"vertical",active:"active"},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.list,((t,o)=>(openBlock(),createBlock(c,{key:o},{"inactive-icon":withCtx((()=>[_hoisted_6])),default:withCtx((()=>{var o,s,i,n,c,h,_,u,p,g,v,m,w,f,N,y,k,B,C,V,x,$,S;return[createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[createBaseVNode("span",_hoisted_9,toDisplayString(a.dealDate(t.created_at)),1),createBaseVNode("span",_hoisted_10,toDisplayString(e.$t("source"))+toDisplayString(t.source),1)]),"twitter"===t.source?(openBlock(),createElementBlock("div",_hoisted_11,[createVNode(l,{class:"logo",width:"30px",height:"30px",src:null==(i=null==(s=null==(o=t.content)?void 0:o.items[0])?void 0:s.user)?void 0:i.profile_image_url_https,fit:"contain","lazy-load":"","loading-icon":"https://www.avestorage.cloud/logo/ave_gray.png","error-icon":"https://www.avestorage.cloud/logo/ave_gray.png",round:""},{error:withCtx((()=>[_hoisted_12])),_:2},1032,["src"]),createBaseVNode("div",_hoisted_13,[createBaseVNode("span",_hoisted_14,[createTextVNode(toDisplayString(null==(h=null==(c=null==(n=t.content)?void 0:n.items[0])?void 0:c.user)?void 0:h.name),1),_hoisted_15]),(null==(p=null==(u=null==(_=t.content)?void 0:_.items[0])?void 0:u.legacy)?void 0:p.retweeted_status_result)?(openBlock(),createElementBlock("span",_hoisted_16,[_hoisted_17,createTextVNode("Â "+toDisplayString(e.$t("forward"))+toDisplayString(null==(m=null==(v=null==(g=t.content)?void 0:g.items[0])?void 0:v.legacy)?void 0:m.retweeted_status_result.user.name),1)])):createCommentVNode("",!0)])])):(openBlock(),createElementBlock("span",_hoisted_18,toDisplayString(null==(f=null==(w=t.content)?void 0:w.items[0])?void 0:f.legacy.title),1)),createBaseVNode("div",_hoisted_19,[createBaseVNode("div",{class:"overflow lineHight20",innerHTML:(null==(k=null==(y=null==(N=t.content)?void 0:N.items[0])?void 0:y.legacy.full_text)?void 0:k.length)>500&&"twitter"!==t.source?(null==(C=null==(B=t.content)?void 0:B.items[0])?void 0:C.legacy.full_text.slice(0,100))+"...":null==(x=null==(V=t.content)?void 0:V.items[0])?void 0:x.legacy.full_text},null,8,_hoisted_20),(null==(S=null==($=t.content)?void 0:$.items[0])?void 0:S.legacy.media)?(openBlock(),createBlock(d,{key:0,gutter:"5",class:"mt-10"},{default:withCtx((()=>{var e,o;return[(openBlock(!0),createElementBlock(Fragment,null,renderList(null==(o=null==(e=t.content)?void 0:e.items[0])?void 0:o.legacy.media,((e,t)=>(openBlock(),createBlock(r,{span:"8",key:t},{default:withCtx((()=>["photo"===e.type?(openBlock(),createBlock(l,{key:0,src:e.media_url_https,width:"100%",fit:"contain","lazy-load":"","loading-icon":"https://www.avestorage.cloud/logo/ave_gray.png","error-icon":"https://www.avestorage.cloud/logo/ave_gray.png",onClick:withModifiers((t=>a.ImagePreview({images:[e.media_url_https],closeable:!0})),["stop"])},null,8,["src","onClick"])):createCommentVNode("",!0)])),_:2},1024)))),128))]})),_:2},1024)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_21,[t.url?(openBlock(),createElementBlock("span",{key:0,class:"span1",onClick:e=>a.view(t)},toDisplayString(e.$t("view")),9,_hoisted_22)):createCommentVNode("",!0)])])]})),_:2},1024)))),128)),createVNode(c,null,{"inactive-icon":withCtx((()=>[])),_:1})])),_:1})])),_:1},8,["loading","finished","loading-text","finished-text","onLoad"])])),_:1},8,["modelValue","onRefresh","loosing-text","pulling-text","loading-text"])],4)]),i.showAd&&i.images.length>0?(openBlock(),createElementBlock("div",_hoisted_23,[createBaseVNode("span",_hoisted_24,toDisplayString(e.$t("ad")),1),createVNode(p,{class:"bg absolute-right",name:"cross",onClick:a.closeAd},null,8,["onClick"]),createVNode(v,{class:"my-swipe",autoplay:3e3,"indicator-color":"white"},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.images,(e=>(openBlock(),createBlock(g,{key:e},{default:withCtx((()=>[createBaseVNode("img",{src:e.PictureLink,alt:e.remark},null,8,_hoisted_25)])),_:2},1024)))),128))])),_:1})],512)):createCommentVNode("",!0)])}var news=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-38cae3d9"]]);export{news as default};
